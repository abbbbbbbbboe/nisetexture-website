const contents = {
  about: [
    {
      id: "profile",
      useSlider: true, 
      title: "Profile",
      title_en: "Profile",
      media: ["nise"],
      media_mobile: ["mobile_nise"],
      text_jp: `å˜ç´”ãƒ»é€€å±ˆã§ç¹°ã‚Šè¿”ã•ã‚Œã‚‹ã€æ—¥å¸¸ã®è¡Œç‚ºã‚„ç”Ÿæ´»ã®ä½œæ¥­ã‚’ã€ãƒ‹ã‚»ãƒ†ã‚¯ã‚¹ãƒãƒ£ï¼ˆç‰©ã‚„äº‹ã«ãŠã‘ã‚‹å½ç‰©ã®è³ªæ„Ÿã€æ‰‹è§¦ã‚Šã€è¡¨é¢ã®æ§˜å­ï¼‰ã«ã‚ˆã£ã¦è¦†ã„éš ã™ãƒ»åè»¢ã•ã›ã‚‹ã“ã¨ã‚’ç›®çš„ã«ã€
      2024å¹´ã‚ˆã‚Šæ´»å‹•ã‚’é–‹å§‹ã—ãŸã‚²ã‚¤ã‚¸ãƒ¥ãƒ„ãƒ»ãƒãƒ¼ãƒ ã€‚ã‚ªã‚ªã‚¿ã‚½ãƒ©ã¨å°æ—ç²è¡£å¥ˆãŒå‚åŠ ã€‚ä¸»ãªæ´»å‹•ã¯é£²ã¿ä¼šã‚’ã—ãŸå¾Œã«ãã®è¡—ã‚’ä¸€æ™©ä¸­æ­©ãã“ã¨ã€‚è¶£å‘³ã¯è¡—ã«ã‚ã‚‹æœ¨æãŒæœ¬ç‰©ã‹ç¢ºèªã™ã‚‹ã“ã¨ã€‚`,
      text_en: `An art team that began its activities in 2024 with the aim of concealing and reversing simple, monotonous, and repetitive everyday actions and routines through â€œfake texturesâ€ â€” simulated surfaces, 
      sensations, and appearances of things and situations. The members are Sora Oota and Reina Kobayashi. Their main activity is walking around the city all night after having a drink together. Their hobby is checking whether the wooden materials found in the city are real or not.`,
         links: {
    "YouTube": "https://youtube.com/@nisetexture?si=XRcAyUBKGoHIAxTG"
  }
    },
    {
      id: "otasora",
      useSlider: true, 
      title: "ã‚ªã‚ªã‚¿ã‚½ãƒ©",
       title_en: "ota sora",
      media: ["ota"],
      media_mobile: ["mobile_ota"],
       text_jp: `1998å¹´ç¦å²¡ç”Ÿã¾ã‚Œã€‚<br>æ­¦è”µé‡ç¾è¡“å¤§å­¦ é€ å½¢å­¦éƒ¨ åŸºç¤ãƒ‡ã‚¶ã‚¤ãƒ³å­¦ç§‘ å’æ¥­ã€‚<br>webã‚µã‚¤ãƒˆã€ã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯ãƒ‡ã‚¶ã‚¤ãƒ³ã€æ˜ åƒã®åˆ¶ä½œã‚’ä¸»ã«è¡Œã†ã€‚ãƒ‰ãƒƒãƒˆã‚„ãƒ‘ã‚¿ãƒ¼ãƒ³ã®è¡¨ç¾ã«èˆˆå‘³ãŒã‚ã‚‹ã€‚<br>
       ãªã‚‹ã¹ãé“å…·ã‚„æ§‹é€ ã‹ã‚‰ä½œã‚‹ã‚ˆã†ã«æ„è­˜ã—ã¦åˆ¶ä½œã™ã‚‹ã€‚`,
      text_en: `Born in Fukuoka in 1998.<br> Graduated from Musashino Art University, Faculty of Design, Department of Basic Design. <br>Primarily creates web, graphic design, and video content.
       Interested in dot and pattern expression. Consciously strives to create works by building from tools and structures whenever possible.`,
         links: {
    "Website": "https://otasora.website/",
    "Instagram": "https://www.instagram.com/abbbbbbbbboe"
  }
    },
    {
      id: "kobayashireina",
      useSlider: true, 
      title: "å°æ—ç²è¡£å¥ˆ",
       title_en: "kobayashi reina",
      media: ["koba"],
      media_mobile: ["mobile_koba"],
    text_jp: `1998å¹´ã€æ„›çŸ¥çœŒåå¤å±‹å¸‚ç”Ÿã¾ã‚Œã€‚<br>2023å¹´ã€æƒ…å ±ç§‘å­¦èŠ¸è¡“å¤§å­¦é™¢å¤§å­¦ï¼»IAMASï¼½ä¿®å£«èª²ç¨‹ä¿®äº†ã€‚<br>é¢¨æ™¯ã«é–¢å¿ƒãŒã‚ã‚Šã€ã•ã•ã‚„ã‹ãªã‚‚ã®ã‚’é›†ã‚ãŸã‚Šã¾ã¨ã‚ãŸã‚Šã™ã‚‹ã“ã¨ã§ã€ç‰©äº‹ã‚’è¦‹å‡ºãã†ã¨ã™ã‚‹ã€‚`,
      text_en: `Born in 1998 in Nagoya, Aichi Prefecture.Completed the Masterâ€™s Program at the Institute of Advanced Media Arts and Sciences (IAMAS) in 2023.<br>With a deep interest in landscapes, she seeks to discover meaning by collecting and assembling subtle, everyday fragments.`,
            links: {
    "Website": "https://www.kobayashireina.com/",
    "Instagram": "https://www.instagram.com/5884017rk/?hl=ja"
  
  }
    },
    {
      id: "statement",
      useSlider:true,
      title: "Statement",
      title_en: "Statement",
      media: ["statement"],
      media_mobile: ["mobile_statement"],
   text_jp: `ç§ãŸã¡ã¯ã‚ã‚‰ã‚†ã‚‹å ´é¢ã§ã®ãƒãƒ©ã‚¹ãƒ¡ãƒ³ãƒˆã‚’è¨±å®¹ã—ã¾ã›ã‚“ã€‚`,
      text_en: `We will not tolerate discrimination or harassment of any kind.`,
            links: {
    
  }
    }
  ]
};

let currentIndex = null;
let currentItemId = null;


// ğŸ“Œ ãƒ¢ãƒã‚¤ãƒ«ãƒ©ãƒ³ãƒ€ãƒ ç”»åƒã®å‰å›ä½¿ç”¨ç•ªå·
const lastMobileImageIndex = {};

// ===============================
// ğŸ”· ã‚¹ãƒãƒ›ã‚¢ãƒ‰ãƒ¬ã‚¹ãƒãƒ¼è¨ˆç®—
// ===============================
function setVh() {
  // innerHeightã®1%ã‚’è¨ˆç®—
  const vh = window.innerHeight * 0.01;
  document.documentElement.style.setProperty('--vh', `${vh}px`);
}

// åˆå›å®Ÿè¡Œ
setVh();

// ãƒªã‚µã‚¤ã‚ºã‚„å›è»¢æ™‚ã«ã‚‚æ›´æ–°
window.addEventListener('resize', setVh);
window.addEventListener('orientationchange', setVh);

// â˜…â˜… ADD START : ãƒ¢ãƒã‚¤ãƒ«åˆ¤å®š + ç¾åœ¨è¡¨ç¤ºã‚¨ãƒªã‚¢ç®¡ç† â˜…â˜…
let activeSection = "list"; 
// "list" | "image" | "text"

function isMobile() {
  return window.matchMedia("(max-width: 768px)").matches;
}

const prevBtn = document.getElementById("nav-prev");
const nextBtn = document.getElementById("nav-next");

function updateMobileView() {
  // PC â†’ ã™ã¹ã¦è¡¨ç¤º & nav éš ã™
  if (!isMobile()) {
    listArea.style.display  = "";
    imageArea.style.display = "";
    textArea.style.display  = "";
    prevBtn.style.display = "none";
    nextBtn.style.display = "none";
    return;
  }

  // mobile â†’ active ã ã‘è¡¨ç¤º
  listArea.style.display  = (activeSection === "list")  ? "" : "none";
  imageArea.style.display = (activeSection === "image") ? "" : "none";
  textArea.style.display  = (activeSection === "text")  ? "" : "none";

  updateNavButtons();
   applyRandomSpacingToListArea();
      applyRandomSpacingToAreaTitles();
}

function updateNavButtons() {

  if (activeSection === "list") {
       // archiveãƒšãƒ¼ã‚¸ã‹ã¤ä½œå“æœªé¸æŠãªã‚‰å³ãƒœã‚¿ãƒ³éè¡¨ç¤º
    if (currentItemId == null) {
      nextBtn.style.display = "none";
      prevBtn.style.display = "none";
    } else {
        prevBtn.style.display = "none";
      nextBtn.style.display = "";
      nextBtn.innerHTML = `â†‘ <span class="mobile-nav-btn-text">image</span>`;
      nextBtn.onclick = () => {
        activeSection = "image";
       updateMobileView();
      applyRandomSpacingToListArea();
      applyRandomSpacingToAreaTitles();
      };
    }
  }

  if (activeSection === "image") {
    // image = å·¦â†’list / å³â†’text
    prevBtn.style.display = "";
    nextBtn.style.display = "";
    prevBtn.innerHTML = `â†“ <span class="mobile-nav-btn-text">title</span>`;
    nextBtn.innerHTML = `â†‘ <span class="mobile-nav-btn-text">text</span>`;

    prevBtn.onclick = () => {
      activeSection = "list";
      updateMobileView();
      applyRandomSpacingToListArea();
      applyRandomSpacingToMobileAreaTitles();
    };
    nextBtn.onclick = () => {
      activeSection = "text";
      updateMobileView();
      applyRandomSpacingToListArea();
      applyRandomSpacingToMobileAreaTitles();
    };
  }

  if (activeSection === "text") {
    // text = å³ãƒœã‚¿ãƒ³ãªã— / å·¦â†’image
    prevBtn.style.display = "";
    prevBtn.innerHTML = `â†“ <span class="mobile-nav-btn-text">image</span>`;
    prevBtn.onclick = () => {
      activeSection = "image";
      updateMobileView();
      applyRandomSpacingToListArea();
      applyRandomSpacingToMobileAreaTitles();
    };
    nextBtn.style.display = "none";
  }
}

// â˜…â˜… ADD END â˜…â˜…

document.addEventListener("DOMContentLoaded", () => {
  if (isMobile()) {
    activeSection = "list";   // â† åˆæœŸçŠ¶æ…‹ã‚’ list ã«æŒ‡å®š
    updateMobileView();       // â† è¡¨ç¤ºã‚’åæ˜ 
  }
  attachScrollStep();
  createScrollTopButton(listContainer, textContainer, imageContainer);
});


// ================================
// ğŸ“Œ DOMè¦ç´ ã®å–å¾—
// ================================
const menuButtons = document.querySelectorAll('.menu button');
const listArea = document.querySelector('.list-area');
const imageArea = document.querySelector('.image-area');
const textArea = document.querySelector('.text-area');
const listContainer = listArea.querySelector('.list-container');
const textContainer = textArea.querySelector('.text-container');
const imageContainer = imageArea.querySelector('.image-container');

function showAboutCategory(category) {
  const items = contents.about;
  if (!items) return;

  // â˜…â˜… ADD START : åˆæœŸè¡¨ç¤ºã¯ image-area â˜…â˜…
activeSection = isMobile() ? "image" : activeSection;
updateMobileView();
// â˜…â˜… ADD END â˜…â˜…

  // --- ã‚¨ãƒªã‚¢åˆæœŸåŒ– ---
  imageContainer.innerHTML = '';
  textContainer.innerHTML = '';

  // --- é¸æŠã•ã‚ŒãŸã‚«ãƒ†ã‚´ãƒªãƒ‡ãƒ¼ã‚¿å–å¾— ---
  const targetItem = items.find(item => item.id === category);
  if (!targetItem) return;

  currentItemId = targetItem.id;
applyRandomSpacingToMobileAreaTitles()
  // ================================
  // ğŸ“· ãƒ¡ãƒ‡ã‚£ã‚¢æç”»å‡¦ç†
  // ================================
if (isMobile() && targetItem.useSlider) {

  const folder = targetItem.media_mobile[0];
  const frameCount = 5;

  // å‰å›ã¨é•ã†ç•ªå·ã‚’é¸ã¶
  let rand;
  do {
    rand = Math.floor(Math.random() * frameCount) + 1;
  } while (lastMobileImageIndex[folder] === rand);

  // è¨˜éŒ²
  lastMobileImageIndex[folder] = rand;

  const img = new Image();

  // ã¾ãš JPG
  img.src = `img/mobile/${folder}/${rand}.jpg`;

  // JPG ãƒ€ãƒ¡ãªã‚‰ PNG
  img.onerror = () => {
    img.onerror = null;
    img.src = `img/mobile/${folder}/${rand}.png`;
  };

  img.classList.add("mobile-random-image");
  imageContainer.appendChild(img);

} else if (targetItem.useSlider) {
    
    targetItem.media.forEach((folder, idx) => {
      const containerId = `imageContainer_${category}_${idx}`;
      const container = document.createElement("div");
      container.id = containerId;
      container.className = "member-slider";
      imageContainer.appendChild(container);

      const frameCount = 5;
      const frameRatios = [6, 4, 3, 6, 9,];
      const cumulative = [];
      const total = frameRatios.reduce((a, b) => a + b, 0);
      let sum = 0;
      frameRatios.forEach(r => {
        sum += r;
        cumulative.push(sum / total);
      });

      const frames = [];
      let currentIndex = -1;
      let imagesLoaded = 0;

 for (let i = 1; i <= frameCount; i++) {
  const img = new Image();

  // ã¾ãš jpg ã‚’è©¦ã™
  img.src = `img/pc/${folder}/${i}.jpg`;

  // jpg ãŒãªã‹ã£ãŸã‚‰ png ã«åˆ‡ã‚Šæ›¿ãˆã‚‹
  img.onerror = () => {
    img.onerror = null; // ç„¡é™ãƒ«ãƒ¼ãƒ—é˜²æ­¢
    img.src = `img/pc/${folder}/${i}.png`;
  };

  img.classList.add("frame");
  container.appendChild(img);
  frames.push(img);

  img.onload = () => {
    imagesLoaded++;
    if (imagesLoaded === frameCount) updateFrameByCursor();
  };
}


      function updateFrameByCursor(e = null) {
        const x = e ? e.clientX : window.innerWidth / 2;
        const ratio = x / window.innerWidth;

        let index = 0;
        for (let i = 0; i < cumulative.length; i++) {
          if (ratio <= cumulative[i]) {
            index = i;
            break;
          }
        }

        if (index !== currentIndex) {
          if (currentIndex >= 0) frames[currentIndex].classList.remove("active");
          frames[index].classList.add("active");
          currentIndex = index;
        }
      }

      window.addEventListener("mousemove", updateFrameByCursor);
    });

  } else {
    // --- é€šå¸¸ãƒ¡ãƒ‡ã‚£ã‚¢æç”» ---
    targetItem.media.forEach((file, idx) => {
      let elementHTML = '';

      if (file.includes("youtube.com") || file.includes("youtu.be")) {
        const embedUrl = file.includes("embed") ? file : convertToYouTubeEmbed(file);
        elementHTML = `<iframe src="${embedUrl}" frameborder="0" allowfullscreen></iframe>`;
      } else if (file.includes("vimeo.com")) {
        const embedUrl = convertToVimeoEmbed(file);
        elementHTML = `<iframe src="${embedUrl}" frameborder="0" allowfullscreen></iframe>`;
      } else if (file.endsWith('.mp4')) {
        elementHTML = `<video src="${file}" controls playsinline></video>`;
      } else {
        elementHTML = `<img src="${file}" alt="${targetItem.title}">`;
      }

      imageContainer.insertAdjacentHTML('beforeend', elementHTML);

      if (targetItem.captions && targetItem.captions[idx]) {
        const caption = document.createElement('div');
        caption.className = 'caption';
        caption.textContent = targetItem.captions[idx];
        imageContainer.appendChild(caption);
      }
    });
  }

  // ================================
  // ğŸ“ ãƒ†ã‚­ã‚¹ãƒˆæç”»å‡¦ç†
  // ================================
  const jpFull = targetItem.text_jp || targetItem.text_ja || targetItem.text || "";
  const enFull = targetItem.text_en || "";
  const creditFull = targetItem.text_credit || "";

  // --- ãƒªãƒ³ã‚¯æç”» ---
if (targetItem.links && Object.keys(targetItem.links).length > 0) {
  // --- ãƒªãƒ³ã‚¯ãŒã‚ã‚‹å ´åˆã®é€šå¸¸å‡¦ç† ---
  const linkContainer = document.createElement('div');
  linkContainer.className = 'text-section text-links';

  for (const [label, url] of Object.entries(targetItem.links)) {
    const linkEl = document.createElement('a');
    linkEl.href = url;
    linkEl.textContent = label;
    linkEl.target = '_blank';
    linkEl.rel = 'noopener noreferrer';
    linkContainer.appendChild(linkEl);
  }

  textContainer.appendChild(linkContainer);

} else {
  // --- links ãŒç©ºã®å ´åˆï¼šé«˜ã•ã ã‘ã®ãƒ€ãƒŸãƒ¼è¦ç´  ---
  const emptyLinkSpace = document.createElement('div');
  emptyLinkSpace.className = 'text-section text-links-empty';

  // é«˜ã•è¨­å®šï¼ˆPC 40px / ãƒ¢ãƒã‚¤ãƒ« 35pxï¼‰
  const isMobileDevice = window.matchMedia("(max-width: 768px)").matches;
  emptyLinkSpace.style.height = isMobileDevice ? "70px" : "80px";

  textContainer.appendChild(emptyLinkSpace);
}


  // === è¨€èªåˆ‡ã‚Šæ›¿ãˆãƒœã‚¿ãƒ³ ===
const langBtn = document.createElement('button');
langBtn.className = "text-section lang-toggle-btn";

// è¨€èªã®ã‚°ãƒ­ãƒ¼ãƒãƒ«çŠ¶æ…‹ï¼ˆç¶­æŒã—ãŸã„å ´åˆï¼‰
let activeLanguage = window.activeLanguage || "ja";
window.activeLanguage = activeLanguage;

textContainer.appendChild(langBtn);

 // --- æ—¥æœ¬èªãƒ†ã‚­ã‚¹ãƒˆ ---

let jaSection = null;
if (jpFull.trim()) {
  jaSection = document.createElement('div');
  jaSection.className = 'text-section text-ja';
   // ãƒ¢ãƒã‚¤ãƒ« â†’ ã‚¿ã‚¤ãƒˆãƒ« + ãƒ†ã‚­ã‚¹ãƒˆ
  // PC â†’ ãƒ†ã‚­ã‚¹ãƒˆã®ã¿
  if (isMobile()) {
    jaSection.innerHTML = `
      <p class="mobile-jp-title">${targetItem.title || ""}</p>
      <p>${jpFull}</p>
    `;
  } else {
    jaSection.innerHTML = `<p>${jpFull}</p>`;
  }
  textContainer.appendChild(jaSection);
}

// --- è‹±èªãƒ†ã‚­ã‚¹ãƒˆ ---

let enSection = null;
if (enFull.trim()) {
  enSection = document.createElement('div');
  enSection.className = 'text-section text-en';
  if (isMobile()) {
    // ãƒ¢ãƒã‚¤ãƒ« â†’ ã‚¿ã‚¤ãƒˆãƒ« + ãƒ†ã‚­ã‚¹ãƒˆ
    enSection.innerHTML = `
      <p class="mobile-en-title">${targetItem.title_en || ""}</p>
      <p>${enFull}</p>
    `;
  } else {
    // PC â†’ ãƒ†ã‚­ã‚¹ãƒˆã®ã¿
    enSection.innerHTML = `<p>${enFull}</p>`;
  }
  textContainer.appendChild(enSection);
}


  if (creditFull.trim()) {
    const creditSection = document.createElement('div');
    creditSection.className = 'text-section text-credit';
    creditSection.innerHTML = `<p>credit<br>${creditFull}</p>`;
    textContainer.appendChild(creditSection);
  }

  
// === è¨€èªé©ç”¨é–¢æ•° ===
function applyLanguage(lang) {
  activeLanguage = lang;
  window.activeLanguage = lang;

  if (jaSection) jaSection.style.display = (lang === "ja") ? "block" : "none";
  if (enSection) enSection.style.display = (lang === "en") ? "block" : "none";

  // ãƒœã‚¿ãƒ³ã®è¡¨ç¤ºãƒ†ã‚­ã‚¹ãƒˆ
  langBtn.textContent = (lang === "ja") ? "EN" : "JP";
}


// === ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯ã§ãƒˆã‚°ãƒ« ===
langBtn.addEventListener("click", () => {
  const newLang = (activeLanguage === "ja") ? "en" : "ja";
  applyLanguage(newLang);
});




// === åˆæœŸè¡¨ç¤º ===
applyLanguage(activeLanguage);


  // --- ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ä½™ç™½ ---
  // const spacerImg = document.createElement('div');
  // spacerImg.className = 'scroll-extra';
  // imageArea.appendChild(spacerImg);


  // --- activeã‚¯ãƒ©ã‚¹æ›´æ–° ---
  updateActiveButton(category);

  // --- ã‚µã‚¤ã‚ºèª¿æ•´ ---
  adjustMediaSizes();

attachScrollStep();

// â˜…â˜… ADD START : ãƒ¢ãƒã‚¤ãƒ«ãƒœã‚¿ãƒ³æ›´æ–° â˜…â˜…
addMobileNavButtons();
updateMobileView();
// â˜…â˜… ADD END â˜…â˜…
applyRandomSpacingToMobileAreaTitles();
createScrollTopButton(listContainer, textContainer, imageContainer);
  
}

// â˜…â˜… ADD START : resize æ™‚ã«ã‚‚åæ˜  â˜…â˜…
// window.addEventListener("resize", () => {
//   updateMobileView();
//   addMobileNavButtons();
// });
// â˜…â˜… ADD END â˜…â˜…


// ================================
// --- activeãƒœã‚¿ãƒ³åˆ‡æ›¿ ---
// ================================
function updateActiveButton(activeCategory) {
  document.querySelectorAll('[data-category]').forEach(btn => {
    if (btn.dataset.category === activeCategory) {
      btn.classList.add('active');
    } else {
      btn.classList.remove('active');
    }
  });
}

// ================================
// --- ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆè¨­å®š ---
// ================================
document.querySelectorAll('[data-category]').forEach(btn => {
  btn.addEventListener('click', () => {
    const category = btn.dataset.category;
    if (category) {
      // ãƒãƒƒã‚·ãƒ¥ã‚’å¤‰æ›´ï¼ˆå±¥æ­´ã«æ®‹ã‚‹ï¼‰
      window.location.hash = category;
      showAboutCategory(category);
      
    }
  });
});

// ================================
// --- ãƒãƒƒã‚·ãƒ¥å¤‰åŒ–æ™‚ï¼ˆãƒ–ãƒ©ã‚¦ã‚¶æˆ»ã‚‹å¯¾å¿œï¼‰ ---
// ================================
window.addEventListener('hashchange', () => {
  const hash = window.location.hash.replace('#', '');
  if (hash) {
    showAboutCategory(hash);
  } else {
    // ãƒãƒƒã‚·ãƒ¥ãŒæ¶ˆãˆãŸå ´åˆã€å…¨ã¦ã®activeã‚’å¤–ã™
    updateActiveButton(null);
  }
});

// ================================
// --- åˆæœŸè¡¨ç¤ºï¼ˆãƒªãƒ­ãƒ¼ãƒ‰æ™‚ï¼‰ ---
// ================================
window.addEventListener('DOMContentLoaded', () => {
  const initialHash = window.location.hash.replace('#', '');
  if (initialHash) {
    showAboutCategory(initialHash);
  }
  attachScrollStep();
});





  // ================================
  // ç”»åƒã‚¨ãƒªã‚¢ã®ãƒªã‚µã‚¤ã‚º
  // ================================
function resizeMediaToFitArea(el, areaWidth) {
  let naturalWidth, naturalHeight, aspectRatio;

  if (el.tagName.toLowerCase() === 'iframe') {
    aspectRatio = 16 / 9;
    naturalWidth = 1600;
    naturalHeight = 900;
  } else {
    naturalWidth = el.naturalWidth || el.videoWidth || el.clientWidth;
    naturalHeight = el.naturalHeight || el.videoHeight || el.clientHeight;
    aspectRatio = naturalWidth / naturalHeight;
  }

  if (!naturalWidth || !naturalHeight) return;

  // ================================
  // ãƒœãƒ¼ãƒ€ãƒ¼åˆ†ã‚’å·®ã—å¼•ã„ãŸæœ‰åŠ¹å¹…
  // ================================
  const borderOffset = 2; // å·¦å³1pxãšã¤
  const usableWidth = areaWidth - borderOffset;

  // âœ… ãƒœãƒ¼ãƒ€ãƒ¼è¨ˆç®—ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§é«˜ã•ã‹ã‚‰ã‚‚1pxæ¸›ã‚‰ã™
  const heightOffset = 1;

  // æ¯”ç‡ã‚’ç¶­æŒã—ã¦æœ€å¤§ã‚µã‚¤ã‚ºã«åã‚ã‚‹
  const scale = Math.min(1, usableWidth / naturalWidth);
  let newWidth = naturalWidth * scale;
  let newHeight = (naturalHeight * scale) - heightOffset;

  // é«˜ã•ã‚’40pxã®å€æ•°ã«èª¿æ•´
const step = isMobile() ? 35 : 40;

  newHeight = Math.floor(newHeight / step) * step;
  if (newHeight < step) newHeight = step;

  newWidth = aspectRatio * newHeight;
  // æ¨ªå¹…ãŒ usableWidth ã‚’è¶…ãˆãŸã‚‰å†èª¿æ•´
  if (newWidth > usableWidth) {
    newWidth = usableWidth;
    newHeight = newWidth / aspectRatio;
    newHeight = Math.floor(newHeight / 40) * 40;
  }

  // âœ… ã“ã“ã§ã¯ã‚‚ã†ç¸¦-1pxã—ãªã„ï¼ˆä¸Šã§å‡¦ç†æ¸ˆã¿ï¼‰
// âœ… ç¸¦ã‚’1pxæ¸›ã‚‰ã™ 
newHeight = newHeight - 1; if (newHeight < 1) newHeight = 1;

newWidth = Math.floor(newWidth);
  // ã‚¹ã‚¿ã‚¤ãƒ«é©ç”¨
  el.style.width = `${newWidth}px`;
  el.style.height = `${newHeight}px`;
  
  el.style.display = 'block';
  el.style.margin = '-1px auto 0px auto';
  el.style.maxWidth = '100%';
  

    // âœ… è¦ªã® member-slider é«˜ã•ã‚‚è¨­å®š
  const parentSlider = el.closest('.member-slider');
  if (parentSlider) {
    parentSlider.style.height = `${newHeight}px`;
  }
}



// ==========================
// ã™ã¹ã¦ã®ãƒ¡ãƒ‡ã‚£ã‚¢ã‚’èª¿æ•´
// ==========================
function adjustMediaSizes() {
  const imageContents = document.querySelector('.image-container');
  if (!imageContents) return;
  

  const styles = getComputedStyle(imageContents);
  const paddingLeft = parseFloat(styles.paddingLeft) || 0;
  const paddingRight = parseFloat(styles.paddingRight) || 0;
  const usableWidth = imageArea.clientWidth - paddingLeft - paddingRight;

  const mediaElements =  imageContents.querySelectorAll('img, video, iframe');

  mediaElements.forEach(el => {
    const applySize = () => resizeMediaToFitArea(el, usableWidth);

    if (el.tagName.toLowerCase() === 'img') {
      if (el.complete) applySize();
      else el.addEventListener('load', applySize);
    } else if (el.tagName.toLowerCase() === 'video') {
      if (el.readyState >= 1) applySize();
      else el.addEventListener('loadedmetadata', applySize);
    } else if (el.tagName.toLowerCase() === 'iframe') {
      el.addEventListener('load', applySize);
      setTimeout(applySize, 300);
    }
  });
}

window.addEventListener('resize', adjustMediaSizes);






// // ==========================
// // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«åˆ¶å¾¡ï¼ˆã‚³ãƒ³ãƒ†ãƒŠå˜ä½ã€æœ€å¾Œã®ã‚¹ãƒ†ãƒƒãƒ—ã§æ­¢ã‚ã‚‹ï¼‰
// // ==========================
// function attachScrollStep() {
//   document.querySelectorAll('.list-container, .image-container, .text-container').forEach(container => {
//     if (container.dataset.scrollAttached === "true") return;
//     container.dataset.scrollAttached = "true";

//     let isScrolling = false;

//     const getStep = () => {
//       const isImg = container.classList.contains('image-container');
//       if (window.innerWidth <= 768) {
//         return isImg ? 35 : 35;   // Mobile
//       } else {
//         return isImg ? 120 : 40;  // PC
//       }
//     };

//     const maxScroll = () => container.scrollHeight - container.clientHeight;

//     const scrollToStep = (direction) => {
//       if (isScrolling) return;
//       isScrolling = true;

//       const step = getStep();
//       let target = container.scrollTop + direction * step;

//       const lastStepTop = Math.floor(maxScroll() / step) * step;
//       if (target > lastStepTop) target = lastStepTop;
//       if (target < 0) target = 0;

//       target = Math.round(target / step) * step;
//       container.scrollTo({ top: target, behavior: 'auto' });

//       setTimeout(() => { isScrolling = false; }, 120);
//     };

//     // ==========================
//     // ğŸ–± PC: wheel
//     // ==========================
//     container.addEventListener(
//       'wheel',
//       (e) => {
//         e.preventDefault();
//         const direction = e.deltaY > 0 ? 1 : -1;
//         scrollToStep(direction);
//       },
//       { passive: false }
//     );

//  // ==========================
//     // ğŸ“± Mobile: touchmove ã§ã‚¹ãƒ†ãƒƒãƒ—ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
//     // ==========================
//     let lastY = 0;
//     let accum = 0;

//     container.addEventListener("touchstart", (e) => {
//       lastY = e.touches[0].clientY;
//       accum = 0;
//     });

//     container.addEventListener("touchmove", (e) => {
//   e.preventDefault(); // æ¨™æº–ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ç„¡åŠ¹

//   const currentY = e.touches[0].clientY;
//   const diff = lastY - currentY;

//   accum += diff;
//   lastY = currentY;

//   const step = getStep();   // â† å®Ÿéš›ã«å‹•ãé‡ï¼ˆä¾‹ï¼š35pxï¼‰
//   const trigger = 6;       // â† æŒ‡ã‚’ä½•pxå‹•ã‹ã—ãŸã‚‰ç™ºç«ã™ã‚‹ã‹

//   if (Math.abs(accum) >= trigger) {
//     const direction = accum > 0 ? 1 : -1;

//     scrollToStep(direction);  // step(35px) ã§å‹•ã

//     // ä½™ã‚Šã‚’æ®‹ã™ï¼ˆæ»‘ã‚‰ã‹é€£ç¶šã‚¹ãƒ†ãƒƒãƒ—ã®ãŸã‚ï¼‰
//     accum = accum % trigger;
//   }
// }, { passive: false });

//     container.addEventListener("touchend", () => {
//       accum = 0;
//     });
//   });
// }




// åˆå›ã‚¿ã‚¤ãƒˆãƒ«ç”Ÿæˆ
// document.querySelectorAll('.list-area, .image-area, .text-area').forEach(area => {
//   if (!area.querySelector('.area-title')) {
//     const title = document.createElement('div');
//     title.className = 'area-title';

//     if (area.classList.contains('list-area')) title.textContent = 'title';
//     if (area.classList.contains('image-area')) title.textContent = 'image';
//     if (area.classList.contains('text-area')) title.textContent = 'text';

//     area.prepend(title);
//   }
// });


// YouTubeã®URLã‚’embedå½¢å¼ã«å¤‰æ›
function convertToYouTubeEmbed(url) {
  const videoId = url.split("v=")[1]?.split("&")[0] || url.split("/").pop();
  return `https://www.youtube.com/embed/${videoId}`;
}

// Vimeoã®URLã‚’embedå½¢å¼ã«å¤‰æ›
function convertToVimeoEmbed(url) {
  const videoId = url.split("/").pop();
  return `https://player.vimeo.com/video/${videoId}`;
}











// ==========================
// ãƒ©ãƒ³ãƒ€ãƒ ã‚¹ãƒšãƒ¼ã‚·ãƒ³ã‚°é–¢æ•°â†“ã‚³ã‚³ã‚«ãƒ©
// ==========================
function randomLetterSpacing(text, minSpacing = -0.5, maxSpacing = 2) {
  return text
    .split('')
    .map(char => {
      const spacing = (Math.random() * (maxSpacing - minSpacing) + minSpacing).toFixed(2);
      return `<span style="letter-spacing:${spacing}px">${char}</span>`;
    })
    .join('');
}

// ==========================
// ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«é©ç”¨
// ==========================
function applyRandomSpacingToMenu() {
  document.querySelectorAll('.menu button , .menu a').forEach(button => {
    const originalText = button.textContent;
    button.innerHTML = randomLetterSpacing(originalText);
  });
}
// ==========================
// ã‚¨ãƒªã‚¢ã‚¿ã‚¤ãƒˆãƒ«ã«é©ç”¨
// ==========================
function applyRandomSpacingToAreaTitles() {
  document.querySelectorAll('.area-title h1').forEach(title => {
    const originalText = title.textContent;
    title.innerHTML = randomLetterSpacing(originalText, 1, 2.5);
  });
}

// ==========================
// listã‚¿ã‚¤ãƒˆãƒ«ã«é©ç”¨
// ==========================
function applyRandomSpacingToListArea() {
  document.querySelectorAll('.list-area button,.list-area p').forEach(title => {
    const originalText = title.textContent;
    title.innerHTML = randomLetterSpacing(originalText,1, 1.5);
  });
}

// ==========================
// mobileã‚¿ã‚¤ãƒˆãƒ«ã«é©ç”¨
// ==========================
function applyRandomSpacingToMobileAreaTitles() {
  document.querySelectorAll('.mobile-nav-btn span').forEach(title => {
    const originalText = title.textContent;
    title.innerHTML = randomLetterSpacing(originalText,1, 2.5);
  });
}

// ==========================
// åˆæœŸåŒ–
// ==========================
window.addEventListener('DOMContentLoaded', () => {
  applyRandomSpacingToMenu();
  applyRandomSpacingToAreaTitles();
  applyRandomSpacingToListArea();
  applyRandomSpacingToMobileAreaTitles()
});

// ==========================
// ãƒ©ãƒ³ãƒ€ãƒ ã‚¹ãƒšãƒ¼ã‚·ãƒ³ã‚°é–¢æ•°â†‘ã“ã“ã¾ã§
// ==========================

// ==========================
// ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒˆãƒƒãƒ—ãƒœã‚¿ãƒ³
// ==========================
function createScrollTopButton(container) {
  if (container.querySelector('.scroll-top-btn')) return;

  const btn = document.createElement('button');
  btn.textContent = 'â†‘';
  btn.className = 'scroll-top-btn';
  container.appendChild(btn); // container å†…ã«è¿½åŠ 
    // åˆæœŸéè¡¨ç¤º
  btn.style.display = 'none';
 
  btn.style.border = '1px solid #b4b4b4';
 
  btn.style.color = '#e1e1e1';
  btn.style.cursor = 'pointer';
  btn.style.zIndex = '900';
 
  // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ç›£è¦–
  container.addEventListener('scroll', () => {
    // ä¸€å®šé‡ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã—ãŸã‚‰è¡¨ç¤º
    if (container.scrollTop > 120) {
      btn.style.display = 'block';
    } else {
      btn.style.display = 'none';
    }

    // ã‚¨ãƒªã‚¢å³ä¸‹ã«ãƒœã‚¿ãƒ³ã‚’é…ç½®ï¼ˆfixedã§è¿½å¾“ï¼‰
    const rect = container.getBoundingClientRect();
    btn.style.position = 'fixed';
 

  if (!isMobile()) {
    btn.style.left = '';
    btn.style.right = (window.innerWidth - rect.right + 30) + 'px'; // å³ç«¯ã‹ã‚‰ã®ä½™ç™½
  } else {
    // ãƒ¢ãƒã‚¤ãƒ«
    if (activeSection === 'list') {
   btn.style.left = '';
    btn.style.right = (window.innerWidth - rect.right + 8) + 'px'; // å³ç«¯ã‹ã‚‰ã®ä½™ç™½
    } else {
     btn.style.left = (rect.left + 8) + 'px'; // 16pxã¯ç”»é¢ç«¯ã‹ã‚‰ã®ä½™ç™½
    btn.style.right = ''; // å¿µã®ãŸã‚å³ã¯ç©ºã«
    }
  }
  });

  btn.addEventListener('click', () => {
    container.scrollTo({ top: 0 });
  });
}


// åˆæœŸè¨­å®š
applyRandomSpacingToMenu();


